---
import AdminHeader from "../components/admin/AdminHeader.astro";
import AdminSidebar from "../components/admin/AdminSidebar.astro";
import Layout from "../layouts/Layout.astro";

import ConnectionsStats from "../components/connections/ConnectionsStats.astro";
import ConnectionsHeader from "../components/connections/ConnectionsHeader.astro";

import { listConnections } from "../lib/api/connections";
import ConnectionsManager from "../islands/ConnectionsManager";

import "../styles/global.css";

// Obtener datos desde la API real
const response = await listConnections();

// El backend devuelve:
// { total: number, connections: SavedConnection[] }
const connections = response.connections;

// Estadísticas (por ahora siempre disconnected porque backend no envía estado)
const totalConnections = response.total;
const connectedCount = 0;
const disconnectedCount = totalConnections;
---

<Layout>
  <AdminSidebar />

  <main class="flex-1 flex flex-col bg-gray-50">
    <AdminHeader />

    <section class="p-8">
      <ConnectionsHeader />

      <ConnectionsStats
        total={totalConnections}
        connected={connectedCount}
        disconnected={disconnectedCount}
      />

      <!-- React island -->
      <ConnectionsManager
        client:load
        initialConnections={connections}
      />
    </section>
  </main>
</Layout>
