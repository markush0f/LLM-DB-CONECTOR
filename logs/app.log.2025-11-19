2025-11-19 00:00:40,831 - app_logger - INFO - REQUEST POST /connections/use/2 | Body={
  "password": "password"
}
2025-11-19 00:00:40,837 - app_logger - INFO - Incoming request: POST /connections/use/2
2025-11-19 00:00:41,218 - app_logger - INFO - Completed POST /connections/use/2 Status=200 Duration=380.60ms
2025-11-19 00:00:41,218 - app_logger - INFO - RESPONSE POST /connections/use/2 | Status=200 | Duration=386.87ms | Body={"message":"Connected successfully to 'Markus'"}
2025-11-19 00:00:45,350 - app_logger - INFO - REQUEST POST /llmsql/generate_sql | Body={
  "user_input": "Devuelveme los ultimos 10 registros de customers"
}
2025-11-19 00:00:45,351 - app_logger - INFO - Incoming request: POST /llmsql/generate_sql
2025-11-19 00:00:45,353 - app_logger - INFO - === SQL Assistant started === User request: Devuelveme los ultimos 10 registros de customers
2025-11-19 00:00:45,353 - app_logger - INFO - [QWEN] Generating next tool-call step...
2025-11-19 00:00:45,353 - app_logger - INFO - Running LLM with prompt (3397 chars)
2025-11-19 00:00:57,375 - app_logger - INFO - LLM execution time: 12021.04 ms
2025-11-19 00:00:57,375 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}


2025-11-19 00:00:57,376 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:00:57,376 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}
[2K
2025-11-19 00:00:57,390 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 00:00:57,390 - app_logger - INFO - [QWEN] Executed EXPLICIT tool: list_schemas
2025-11-19 00:00:57,391 - app_logger - INFO - [QWEN] Auto-selected schema: public
2025-11-19 00:00:57,391 - app_logger - INFO - [QWEN] Generating next tool-call step...
2025-11-19 00:00:57,391 - app_logger - INFO - Running LLM with prompt (3476 chars)
2025-11-19 00:01:03,061 - app_logger - INFO - LLM execution time: 5669.03 ms
2025-11-19 00:01:03,061 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 00:01:03,061 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:01:03,061 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 00:01:03,073 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 00:01:03,073 - app_logger - INFO - [QWEN] Executed EXPLICIT tool: list_tables
2025-11-19 00:01:03,074 - app_logger - INFO - [QWEN] Generating next tool-call step...
2025-11-19 00:01:03,074 - app_logger - INFO - Running LLM with prompt (3643 chars)
2025-11-19 00:01:08,906 - app_logger - INFO - LLM execution time: 5832.19 ms
2025-11-19 00:01:08,907 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "get_columns",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}


2025-11-19 00:01:08,907 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:01:08,907 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "get_columns",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
[2K
2025-11-19 00:01:08,911 - app_logger - DEBUG - load_sql result for table_columns.sql: SELECT 
    c.column_name,
    c.data_type,
    c.is_nullable,
    c.column_default,
    CASE WHEN pk.column_name IS NOT NULL THEN TRUE ELSE FALSE END AS is_primary_key,
    fk.foreign_table_name,
    fk.foreign_column_name
FROM information_schema.columns c
LEFT JOIN (
    SELECT 
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    WHERE tc.constraint_type = 'PRIMARY KEY'
) pk
    ON c.table_schema = pk.table_schema
    AND c.table_name = pk.table_name
    AND c.column_name = pk.column_name
LEFT JOIN (
    SELECT
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name,
        ccu.table_name AS foreign_table_name,
        ccu.column_name AS foreign_column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    JOIN information_schema.constraint_column_usage ccu
        ON ccu.constraint_name = tc.constraint_name
        AND ccu.table_schema = tc.table_schema
    WHERE tc.constraint_type = 'FOREIGN KEY'
) fk
    ON c.table_schema = fk.table_schema
    AND c.table_name = fk.table_name
    AND c.column_name = fk.column_name
WHERE c.table_schema = :schema_name
AND c.table_name = :table_name
ORDER BY c.ordinal_position;

2025-11-19 00:01:08,928 - app_logger - DEBUG - get_table_columns result for public.customers: [{'column_name': 'customer_id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': "nextval('customers_customer_id_seq'::regclass)", 'is_primary_key': True, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'first_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'last_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'email', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'created_at', 'data_type': 'timestamp without time zone', 'is_nullable': 'YES', 'column_default': 'CURRENT_TIMESTAMP', 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}]
2025-11-19 00:01:08,929 - app_logger - INFO - [QWEN] Executed EXPLICIT tool: get_columns
2025-11-19 00:01:08,929 - app_logger - INFO - [QWEN] Generating next tool-call step...
2025-11-19 00:01:08,929 - app_logger - INFO - Running LLM with prompt (4765 chars)
2025-11-19 00:01:12,726 - app_logger - INFO - LLM execution time: 3796.75 ms
2025-11-19 00:01:12,727 - app_logger - DEBUG - ----- RAW STDOUT -----
FINAL_METADATA
{
  "ready": true,
  "reason": "metadata complete"
}


2025-11-19 00:01:12,727 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:01:12,728 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
FINAL_METADATA
{
  "ready": true,
  "reason": "metadata complete"
}
[2K
2025-11-19 00:01:12,728 - app_logger - INFO - [QWEN] FINAL_METADATA detected. Switching to SQLCoder.
2025-11-19 00:01:12,729 - app_logger - INFO - [SQLCODER] Building SQL input prompt...
2025-11-19 00:01:12,729 - app_logger - INFO - Completed POST /llmsql/generate_sql Status=500 Duration=27378.06ms
2025-11-19 00:01:12,730 - app_logger - INFO - RESPONSE POST /llmsql/generate_sql | Status=500 | Duration=27379.65ms | Body={"detail":"Agent error: 'table'"}
2025-11-19 00:05:30,049 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:05:33,679 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 00:05:33,680 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 00:05:33,681 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.88ms
2025-11-19 00:05:33,681 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.71ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 00:05:35,803 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 00:05:35,803 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 00:05:35,804 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.77ms
2025-11-19 00:05:35,805 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.73ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 00:05:35,981 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 00:05:35,982 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 00:05:36,033 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=51.24ms
2025-11-19 00:05:36,034 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=52.51ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 00:05:48,727 - app_logger - INFO - REQUEST POST /connections/use/2 | Body={
  "password": "password"
}
2025-11-19 00:05:48,728 - app_logger - INFO - Incoming request: POST /connections/use/2
2025-11-19 00:05:49,050 - app_logger - INFO - Completed POST /connections/use/2 Status=200 Duration=322.65ms
2025-11-19 00:05:49,051 - app_logger - INFO - RESPONSE POST /connections/use/2 | Status=200 | Duration=323.97ms | Body={"message":"Connected successfully to 'Markus'"}
2025-11-19 00:06:14,877 - app_logger - INFO - REQUEST POST /llmsql/generate_sql | Body={
  "user_input": "Creame 10 recursos para customers con datos mockeados"
}
2025-11-19 00:06:14,877 - app_logger - INFO - Incoming request: POST /llmsql/generate_sql
2025-11-19 00:06:14,881 - app_logger - INFO - Agent started for: Creame 10 recursos para customers con datos mockeados
2025-11-19 00:06:14,881 - app_logger - INFO - Running LLM with prompt (3352 chars)
2025-11-19 00:06:20,147 - app_logger - INFO - LLM execution time: 5265.51 ms
2025-11-19 00:06:20,147 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL  
{  
  "name": "list_schemas",  
  "arguments": {}  
}


2025-11-19 00:06:20,147 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:06:20,148 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL  
{  
  "name": "list_schemas",  
  "arguments": {}  
}
[2K
2025-11-19 00:06:20,150 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 00:06:20,151 - app_logger - INFO - Running LLM with prompt (3431 chars)
2025-11-19 00:06:25,351 - app_logger - INFO - LLM execution time: 5200.34 ms
2025-11-19 00:06:25,351 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 00:06:25,352 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:06:25,352 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 00:06:25,355 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 00:06:25,355 - app_logger - INFO - Running LLM with prompt (3598 chars)
2025-11-19 00:06:30,575 - app_logger - INFO - LLM execution time: 5219.27 ms
2025-11-19 00:06:30,575 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}


2025-11-19 00:06:30,575 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:06:30,575 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
[2K
2025-11-19 00:06:30,576 - app_logger - INFO - describe_table requested for public.customers
2025-11-19 00:06:30,576 - app_logger - INFO - Cache miss for public.customers
2025-11-19 00:06:30,576 - app_logger - INFO - Fetching fresh metadata for public.customers
2025-11-19 00:06:30,579 - app_logger - DEBUG - load_sql result for table_columns.sql: SELECT 
    c.column_name,
    c.data_type,
    c.is_nullable,
    c.column_default,
    CASE WHEN pk.column_name IS NOT NULL THEN TRUE ELSE FALSE END AS is_primary_key,
    fk.foreign_table_name,
    fk.foreign_column_name
FROM information_schema.columns c
LEFT JOIN (
    SELECT 
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    WHERE tc.constraint_type = 'PRIMARY KEY'
) pk
    ON c.table_schema = pk.table_schema
    AND c.table_name = pk.table_name
    AND c.column_name = pk.column_name
LEFT JOIN (
    SELECT
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name,
        ccu.table_name AS foreign_table_name,
        ccu.column_name AS foreign_column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    JOIN information_schema.constraint_column_usage ccu
        ON ccu.constraint_name = tc.constraint_name
        AND ccu.table_schema = tc.table_schema
    WHERE tc.constraint_type = 'FOREIGN KEY'
) fk
    ON c.table_schema = fk.table_schema
    AND c.table_name = fk.table_name
    AND c.column_name = fk.column_name
WHERE c.table_schema = :schema_name
AND c.table_name = :table_name
ORDER BY c.ordinal_position;

2025-11-19 00:06:30,592 - app_logger - DEBUG - get_table_columns result for public.customers: [{'column_name': 'customer_id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': "nextval('customers_customer_id_seq'::regclass)", 'is_primary_key': True, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'first_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'last_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'email', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'created_at', 'data_type': 'timestamp without time zone', 'is_nullable': 'YES', 'column_default': 'CURRENT_TIMESTAMP', 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}]
2025-11-19 00:06:30,595 - app_logger - DEBUG - load_sql result for primary_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc
  ON tc.constraint_name = kc.constraint_name
WHERE tc.constraint_type = 'PRIMARY KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 00:06:30,599 - app_logger - DEBUG - fetch_primary_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'customers', 'column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_item_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'payment_id'}, {'table_schema': 'public', 'table_name': 'products', 'column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'id'}, {'table_schema': 'public', 'table_name': 'usuario', 'column_name': 'id'}]
2025-11-19 00:06:30,599 - app_logger - DEBUG - get_primary_keys result for public.customers: ['customer_id']
2025-11-19 00:06:30,602 - app_logger - DEBUG - load_sql result for foreign_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc 
  ON tc.constraint_name = kc.constraint_name
JOIN information_schema.constraint_column_usage ccu 
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 00:06:30,613 - app_logger - DEBUG - fetch_foreign_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'product_id', 'foreign_table_name': 'products', 'foreign_column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}]
2025-11-19 00:06:30,613 - app_logger - DEBUG - get_foreign_keys result for public.customers: []
2025-11-19 00:06:30,613 - app_logger - INFO - Stored metadata in cache for public.customers
2025-11-19 00:06:30,613 - app_logger - INFO - Stored fresh metadata for public.customers
2025-11-19 00:06:30,613 - app_logger - INFO - Running LLM with prompt (4789 chars)
2025-11-19 00:06:59,893 - app_logger - INFO - LLM execution time: 29279.14 ms
2025-11-19 00:06:59,893 - app_logger - DEBUG - ----- RAW STDOUT -----
```json
FINAL_SQL
{
  "sql": "INSERT INTO customers (first_name, last_name, email) VALUES ('John', 'Doe', 'john.doe@example.com'), ('Jane', 'Smith', 'jane.smith@example.com'), ('Alice', 'Johnson', 'alice.johnson@example.com'), ('Bob', 'Brown', 'bob.brown@example.com'), ('Charlie', 'Davis', 'charlie.davis@example.com'), ('Eve', 'Miller', 'eve.miller@example.com'), ('Frank', 'Wilson', 'frank.wilson@example.com'), ('Grace', 'Moore', 'grace.moore@example.com'), ('Heidi', 'Taylor', 'heidi.taylor@example.com'), ('Ivan', 'Anderson', 'ivan.anderson@example.com');",
  "explanation": "Inserting 10 mock customers into the customers table."
}
```


2025-11-19 00:06:59,893 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:06:59,894 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
```json
FINAL_SQL
{
  "sql": "INSERT INTO customers (first_name, last_name, email) VALUES ('John', 'Doe', 'john.doe@example.com'), ('Jane', 'Smith', 'jane.smith@example.com'), ('Alice', 'Johnson', 'alice.johnson@example.com'), ('Bob', 'Brown', 'bob.brown@example.com'), ('Charlie', 'Davis', 'charlie.davis@example.com'), ('Eve', 'Miller', 'eve.miller@example.com'), ('Frank', 'Wilson', 'frank.wilson@example.com'), ('Grace', 'Moore', 'grace.moore@example.com'), ('Heidi', 'Taylor', 'heidi.taylor@example.com'), ('Ivan', 'Anderson', 'ivan.anderson@example.com');",
  "explanation": "Inserting 10 mock customers into the customers table."
}
```
[2K
2025-11-19 00:06:59,895 - app_logger - INFO - Completed POST /llmsql/generate_sql Status=200 Duration=45017.05ms
2025-11-19 00:06:59,895 - app_logger - INFO - RESPONSE POST /llmsql/generate_sql | Status=200 | Duration=45018.41ms | Body={"generated_sql":"INSERT INTO customers (first_name, last_name, email) VALUES ('John', 'Doe', 'john.doe@example.com'), ('Jane', 'Smith', 'jane.smith@example.com'), ('Alice', 'Johnson', 'alice.johnson@example.com'), ('Bob', 'Brown', 'bob.brown@example.com'), ('Charlie', 'Davis', 'charlie.davis@example.com'), ('Eve', 'Miller', 'eve.miller@example.com'), ('Frank', 'Wilson', 'frank.wilson@example.com'), ('Grace', 'Moore', 'grace.moore@example.com'), ('Heidi', 'Taylor', 'heidi.taylor@example.com'), ('Ivan', 'Anderson', 'ivan.anderson@example.com');","explanation":"Inserting 10 mock customers into the customers table.","preview":"Review this SQL before execution."}
2025-11-19 00:09:52,374 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:09:57,211 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:09:58,165 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 00:09:58,166 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 00:09:58,166 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.73ms
2025-11-19 00:09:58,167 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.71ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 00:09:58,314 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 00:09:58,314 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 00:09:58,343 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=28.48ms
2025-11-19 00:09:58,343 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=29.48ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 00:10:01,006 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 00:10:01,007 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 00:10:01,012 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=5.55ms
2025-11-19 00:10:01,013 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=6.49ms | Body={"total":0,"connections":[]}
2025-11-19 00:10:29,569 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_database"
}
2025-11-19 00:10:29,569 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 00:10:29,586 - app_logger - INFO - Completed POST /connections/save Status=200 Duration=16.31ms
2025-11-19 00:10:29,586 - app_logger - INFO - RESPONSE POST /connections/save | Status=200 | Duration=17.28ms | Body={"message":"Connection saved successfully.","connection":{"id":1,"name":"ai_database","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T00:10:29.573866"}}
2025-11-19 00:10:34,555 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 00:10:34,555 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 00:10:34,558 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=2.27ms
2025-11-19 00:10:34,558 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=3.54ms | Body={"total":1,"connections":[{"id":1,"name":"ai_database","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T00:10:29.573866"}]}
2025-11-19 00:10:41,017 - app_logger - INFO - REQUEST POST /connections/use/1 | Body={
  "password": "password"
}
2025-11-19 00:10:41,018 - app_logger - INFO - Incoming request: POST /connections/use/1
2025-11-19 00:10:41,378 - app_logger - INFO - Completed POST /connections/use/1 Status=200 Duration=360.21ms
2025-11-19 00:10:41,378 - app_logger - INFO - RESPONSE POST /connections/use/1 | Status=200 | Duration=361.06ms | Body={"message":"Connected successfully to 'ai_database'"}
2025-11-19 00:12:56,319 - app_logger - INFO - REQUEST POST /llmsql/generate_sql | Body={
  "user_input": "Necesito crear una tabla la cual haga lo siguiente, tenga una relacion con customers, la tabla se llame, clients_enterprise, tiene que tener nombre y descripcion"
}
2025-11-19 00:12:56,319 - app_logger - INFO - Incoming request: POST /llmsql/generate_sql
2025-11-19 00:12:56,321 - app_logger - INFO - Agent started for: Necesito crear una tabla la cual haga lo siguiente, tenga una relacion con customers, la tabla se llame, clients_enterprise, tiene que tener nombre y descripcion
2025-11-19 00:12:56,321 - app_logger - INFO - Running LLM with prompt (3460 chars)
2025-11-19 00:13:05,577 - app_logger - INFO - LLM execution time: 9255.15 ms
2025-11-19 00:13:05,577 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}


2025-11-19 00:13:05,578 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:13:05,578 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}
[2K
2025-11-19 00:13:05,581 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 00:13:05,582 - app_logger - INFO - Running LLM with prompt (3539 chars)
2025-11-19 00:13:10,656 - app_logger - INFO - LLM execution time: 5073.87 ms
2025-11-19 00:13:10,656 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 00:13:10,656 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:13:10,656 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 00:13:10,659 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 00:13:10,660 - app_logger - INFO - Running LLM with prompt (3706 chars)
2025-11-19 00:13:16,143 - app_logger - INFO - LLM execution time: 5483.04 ms
2025-11-19 00:13:16,143 - app_logger - DEBUG - ----- RAW STDOUT -----
```json
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
```


2025-11-19 00:13:16,143 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:13:16,144 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
```json
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
```
[2K
2025-11-19 00:13:16,144 - app_logger - INFO - describe_table requested for public.customers
2025-11-19 00:13:16,144 - app_logger - INFO - Cache miss for public.customers
2025-11-19 00:13:16,144 - app_logger - INFO - Fetching fresh metadata for public.customers
2025-11-19 00:13:16,146 - app_logger - DEBUG - load_sql result for table_columns.sql: SELECT 
    c.column_name,
    c.data_type,
    c.is_nullable,
    c.column_default,
    CASE WHEN pk.column_name IS NOT NULL THEN TRUE ELSE FALSE END AS is_primary_key,
    fk.foreign_table_name,
    fk.foreign_column_name
FROM information_schema.columns c
LEFT JOIN (
    SELECT 
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    WHERE tc.constraint_type = 'PRIMARY KEY'
) pk
    ON c.table_schema = pk.table_schema
    AND c.table_name = pk.table_name
    AND c.column_name = pk.column_name
LEFT JOIN (
    SELECT
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name,
        ccu.table_name AS foreign_table_name,
        ccu.column_name AS foreign_column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    JOIN information_schema.constraint_column_usage ccu
        ON ccu.constraint_name = tc.constraint_name
        AND ccu.table_schema = tc.table_schema
    WHERE tc.constraint_type = 'FOREIGN KEY'
) fk
    ON c.table_schema = fk.table_schema
    AND c.table_name = fk.table_name
    AND c.column_name = fk.column_name
WHERE c.table_schema = :schema_name
AND c.table_name = :table_name
ORDER BY c.ordinal_position;

2025-11-19 00:13:16,157 - app_logger - DEBUG - get_table_columns result for public.customers: [{'column_name': 'customer_id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': "nextval('customers_customer_id_seq'::regclass)", 'is_primary_key': True, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'first_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'last_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'email', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'created_at', 'data_type': 'timestamp without time zone', 'is_nullable': 'YES', 'column_default': 'CURRENT_TIMESTAMP', 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}]
2025-11-19 00:13:16,159 - app_logger - DEBUG - load_sql result for primary_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc
  ON tc.constraint_name = kc.constraint_name
WHERE tc.constraint_type = 'PRIMARY KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 00:13:16,163 - app_logger - DEBUG - fetch_primary_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'customers', 'column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_item_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'payment_id'}, {'table_schema': 'public', 'table_name': 'products', 'column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'id'}, {'table_schema': 'public', 'table_name': 'usuario', 'column_name': 'id'}]
2025-11-19 00:13:16,163 - app_logger - DEBUG - get_primary_keys result for public.customers: ['customer_id']
2025-11-19 00:13:16,165 - app_logger - DEBUG - load_sql result for foreign_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc 
  ON tc.constraint_name = kc.constraint_name
JOIN information_schema.constraint_column_usage ccu 
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 00:13:16,174 - app_logger - DEBUG - fetch_foreign_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'product_id', 'foreign_table_name': 'products', 'foreign_column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}]
2025-11-19 00:13:16,174 - app_logger - DEBUG - get_foreign_keys result for public.customers: []
2025-11-19 00:13:16,174 - app_logger - INFO - Stored metadata in cache for public.customers
2025-11-19 00:13:16,174 - app_logger - INFO - Stored fresh metadata for public.customers
2025-11-19 00:13:16,174 - app_logger - INFO - Running LLM with prompt (4897 chars)
2025-11-19 00:13:21,635 - app_logger - INFO - LLM execution time: 5460.79 ms
2025-11-19 00:13:21,636 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}


2025-11-19 00:13:21,636 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:13:21,636 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
[2K
2025-11-19 00:13:21,636 - app_logger - INFO - describe_table requested for public.customers
2025-11-19 00:13:21,637 - app_logger - INFO - Cache hit for public.customers
2025-11-19 00:13:21,637 - app_logger - INFO - Returning cached metadata for public.customers
2025-11-19 00:13:21,637 - app_logger - INFO - Running LLM with prompt (6088 chars)
2025-11-19 00:13:27,163 - app_logger - INFO - LLM execution time: 5526.10 ms
2025-11-19 00:13:27,164 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}


2025-11-19 00:13:27,164 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:13:27,164 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
[2K
2025-11-19 00:13:27,164 - app_logger - INFO - describe_table requested for public.customers
2025-11-19 00:13:27,165 - app_logger - INFO - Cache hit for public.customers
2025-11-19 00:13:27,165 - app_logger - INFO - Returning cached metadata for public.customers
2025-11-19 00:13:27,165 - app_logger - INFO - Running LLM with prompt (7279 chars)
2025-11-19 00:13:31,952 - app_logger - INFO - LLM execution time: 4787.01 ms
2025-11-19 00:13:31,952 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "describe_schema",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 00:13:31,952 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 00:13:31,953 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "describe_schema",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 00:13:31,953 - app_logger - INFO - Completed POST /llmsql/generate_sql Status=500 Duration=35633.89ms
2025-11-19 00:13:31,954 - app_logger - INFO - RESPONSE POST /llmsql/generate_sql | Status=500 | Duration=35634.95ms | Body={"detail":"Agent error: Unknown tool: describe_schema"}
2025-11-19 00:14:59,400 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:15:28,622 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:15:31,308 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:15:58,978 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:16:01,740 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:16:31,712 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:40:28,677 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 00:40:30,720 - app_logger - INFO - REQUEST GET / | Body=
2025-11-19 00:40:30,721 - app_logger - INFO - Incoming request: GET /
2025-11-19 00:40:30,722 - app_logger - INFO - Completed GET / Status=200 Duration=1.21ms
2025-11-19 00:40:30,722 - app_logger - INFO - RESPONSE GET / | Status=200 | Duration=2.21ms | Body={"available_endpoints":[{"path":"/openapi.json"},{"path":"/docs"},{"path":"/docs/oauth2-redirect"},{"path":"/redoc"},{"path":"/"},{"path":"/connections/save"},{"path":"/connections/list"},{"path":"/connections/{connection_id}"},{"path":"/connections/use/{connection_id}"},{"path":"/connections/disconnect"},{"path":"/llmsql/generate_sql"},{"path":"/llmsql/execute_sql"},{"path":"/llmsql/history"},{"path":"/db/schema"},{"path":"/db/schemas"},{"path":"/db/tables"},{"path":"/db/columns"},{"path":"/cache/metadata/invalidate"},{"path":"/cache/metadata/status"},{"path":"/admin"}]}
2025-11-19 00:40:32,808 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 00:40:32,808 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 00:40:32,809 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.53ms
2025-11-19 00:40:32,809 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.47ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 00:40:32,881 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 00:40:32,882 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 00:40:32,906 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=24.37ms
2025-11-19 00:40:32,907 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=25.37ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 00:40:36,418 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 00:40:36,419 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 00:40:36,425 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=5.83ms
2025-11-19 00:40:36,425 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=6.89ms | Body={"total":0,"connections":[]}
2025-11-19 00:41:05,980 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_database"
}
2025-11-19 00:41:05,982 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 00:41:05,989 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=7.82ms
2025-11-19 00:41:05,990 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=9.57ms | Body={"detail":"A connection named 'ai_database' already exists."}
2025-11-19 00:41:10,106 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 00:41:10,106 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 00:41:10,109 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=2.74ms
2025-11-19 00:41:10,110 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=3.66ms | Body={"total":0,"connections":[]}
2025-11-19 18:24:23,248 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:25:23,129 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:26:25,570 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:27:58,903 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:28:00,627 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 18:28:00,627 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 18:28:00,628 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.64ms
2025-11-19 18:28:00,628 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.59ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 18:28:00,926 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 18:28:00,926 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 18:28:00,965 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=39.06ms
2025-11-19 18:28:00,966 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=39.88ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 18:28:20,363 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 18:28:20,364 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 18:28:20,372 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=8.16ms
2025-11-19 18:28:20,372 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=9.09ms | Body={"total":0,"connections":[]}
2025-11-19 18:28:28,810 - app_logger - INFO - REQUEST POST /connections/use/1 | Body={
  "password": "password"
}
2025-11-19 18:28:28,810 - app_logger - INFO - Incoming request: POST /connections/use/1
2025-11-19 18:28:28,820 - app_logger - INFO - Completed POST /connections/use/1 Status=404 Duration=9.69ms
2025-11-19 18:28:28,820 - app_logger - INFO - RESPONSE POST /connections/use/1 | Status=404 | Duration=10.57ms | Body={"detail":"Connection not found."}
2025-11-19 18:28:32,712 - app_logger - INFO - REQUEST POST /connections/use/2 | Body={
  "password": "password"
}
2025-11-19 18:28:32,713 - app_logger - INFO - Incoming request: POST /connections/use/2
2025-11-19 18:28:32,717 - app_logger - INFO - Completed POST /connections/use/2 Status=404 Duration=3.12ms
2025-11-19 18:28:32,717 - app_logger - INFO - RESPONSE POST /connections/use/2 | Status=404 | Duration=53.12ms | Body={"detail":"Connection not found."}
2025-11-19 18:29:08,407 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_database"
}
2025-11-19 18:29:08,407 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:29:08,413 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=5.73ms
2025-11-19 18:29:08,413 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=6.71ms | Body={"detail":"A connection named 'ai_database' already exists."}
2025-11-19 18:29:13,903 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 18:29:13,904 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 18:29:13,906 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=2.24ms
2025-11-19 18:29:13,906 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=3.03ms | Body={"total":0,"connections":[]}
2025-11-19 18:29:14,880 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 18:29:14,881 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 18:29:14,883 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=2.14ms
2025-11-19 18:29:14,883 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=3.14ms | Body={"total":0,"connections":[]}
2025-11-19 18:29:42,280 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_databasee"
}
2025-11-19 18:29:42,281 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:29:42,285 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=4.10ms
2025-11-19 18:29:42,286 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=5.55ms | Body={"detail":"A connection named 'ai_databasee' already exists."}
2025-11-19 18:30:31,599 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:30:42,285 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 18:30:42,286 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 18:30:42,287 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.82ms
2025-11-19 18:30:42,287 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.78ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 18:30:42,540 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 18:30:42,540 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 18:30:42,568 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=27.86ms
2025-11-19 18:30:42,568 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=28.82ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 18:30:45,262 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_databasee"
}
2025-11-19 18:30:45,262 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:30:45,271 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=8.73ms
2025-11-19 18:30:45,272 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=55.18ms | Body={"detail":"A connection named 'ai_databasee' already exists."}
2025-11-19 18:32:10,473 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:32:43,299 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:33:11,998 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_databasee"
}
2025-11-19 18:33:11,999 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:33:12,002 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=3.15ms
2025-11-19 18:33:12,002 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=4.39ms | Body={"detail":"name 'password' is not defined"}
2025-11-19 18:33:16,073 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:33:49,528 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:34:02,145 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_databasee"
}
2025-11-19 18:34:02,145 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:34:02,162 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=17.05ms
2025-11-19 18:34:02,162 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=17.92ms | Body={"detail":"'Connection' object has no attribute 'as_dict'"}
2025-11-19 18:34:22,276 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:34:37,551 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_databasee"
}
2025-11-19 18:34:37,551 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:34:37,571 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=19.89ms
2025-11-19 18:34:37,571 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=20.83ms | Body={"detail":"'Connection' object has no attribute 'as_dict'"}
2025-11-19 18:34:44,338 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:34:50,698 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_databasee"
}
2025-11-19 18:34:50,699 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:34:50,717 - app_logger - INFO - Completed POST /connections/save Status=400 Duration=18.26ms
2025-11-19 18:34:50,717 - app_logger - INFO - RESPONSE POST /connections/save | Status=400 | Duration=19.43ms | Body={"detail":"'Connection' object has no attribute 'as_dict'"}
2025-11-19 18:35:19,087 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:35:34,879 - app_logger - INFO - REQUEST POST /connections/save | Body={
  "host": "localhost",
  "port": 5432,
  "user": "user",
  "password": "password",
  "database": "ai_database",
  "name": "ai_databasee"
}
2025-11-19 18:35:34,879 - app_logger - INFO - Incoming request: POST /connections/save
2025-11-19 18:35:34,901 - app_logger - INFO - Completed POST /connections/save Status=200 Duration=21.54ms
2025-11-19 18:35:34,901 - app_logger - INFO - RESPONSE POST /connections/save | Status=200 | Duration=22.71ms | Body={"message":"Connection saved successfully.","connection":{"id":4,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:35:34.883914"}}
2025-11-19 18:35:43,709 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 18:35:43,709 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 18:35:43,714 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=4.77ms
2025-11-19 18:35:43,714 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=5.77ms | Body={"total":4,"connections":[{"id":1,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:02.148481"},{"id":2,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:37.555428"},{"id":3,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:50.702764"},{"id":4,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:35:34.883914"}]}
2025-11-19 18:36:03,061 - app_logger - INFO - REQUEST POST /connections/use/1 | Body={
  "password": "password"
}
2025-11-19 18:36:03,061 - app_logger - INFO - Incoming request: POST /connections/use/1
2025-11-19 18:36:03,690 - app_logger - INFO - Completed POST /connections/use/1 Status=400 Duration=629.08ms
2025-11-19 18:36:03,691 - app_logger - INFO - RESPONSE POST /connections/use/1 | Status=400 | Duration=629.98ms | Body={"detail":"Failed to connect to database."}
2025-11-19 18:36:18,496 - app_logger - INFO - REQUEST POST /connections/use/1 | Body={
  "password": "password"
}
2025-11-19 18:36:18,496 - app_logger - INFO - Incoming request: POST /connections/use/1
2025-11-19 18:36:18,596 - app_logger - INFO - Completed POST /connections/use/1 Status=200 Duration=100.29ms
2025-11-19 18:36:18,597 - app_logger - INFO - RESPONSE POST /connections/use/1 | Status=200 | Duration=101.33ms | Body={"message":"Connected successfully to 'ai_databasee'"}
2025-11-19 18:36:56,263 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:37:28,204 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:38:30,769 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:39:01,247 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:40:09,048 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:41:15,407 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:41:49,320 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:42:51,101 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:55:31,252 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:55:58,166 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 18:55:58,166 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 18:55:58,167 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.63ms
2025-11-19 18:55:58,168 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.63ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 18:55:58,261 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 18:55:58,261 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 18:55:58,286 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=24.57ms
2025-11-19 18:55:58,286 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=25.55ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/llmsql/":{"get":{"tags":["SQL Assistant"],"summary":"Save Prompt","operationId":"save_prompt_llmsql__get","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 18:56:14,513 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 18:56:14,513 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 18:56:14,514 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.56ms
2025-11-19 18:56:14,514 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.44ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 18:56:14,577 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 18:56:14,578 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 18:56:14,579 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=0.88ms
2025-11-19 18:56:14,579 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=1.94ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/llmsql/":{"get":{"tags":["SQL Assistant"],"summary":"Save Prompt","operationId":"save_prompt_llmsql__get","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 18:56:23,265 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:56:23,999 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 18:56:24,000 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 18:56:24,000 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.71ms
2025-11-19 18:56:24,001 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.62ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 18:56:24,047 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 18:56:24,048 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 18:56:24,075 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=27.06ms
2025-11-19 18:56:24,075 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=28.19ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/llmsql/":{"post":{"tags":["SQL Assistant"],"summary":"Save Prompt","operationId":"save_prompt_llmsql__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 18:56:36,701 - app_logger - INFO - REQUEST POST /llmsql/ | Body={
  "user_input": "Guardado testeo"
}
2025-11-19 18:56:36,701 - app_logger - INFO - Incoming request: POST /llmsql/
2025-11-19 18:56:36,720 - app_logger - INFO - Completed POST /llmsql/ Status=200 Duration=18.91ms
2025-11-19 18:56:36,721 - app_logger - INFO - RESPONSE POST /llmsql/ | Status=200 | Duration=19.83ms | Body={"content":"Guardado testeo","model_name":"qwen2.5-coder:14b","created_at":"2025-11-19T18:56:36.705803","id":1}
2025-11-19 18:57:25,539 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:57:55,832 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:59:22,450 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 18:59:53,484 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 19:00:05,618 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 19:00:06,561 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 19:00:06,562 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 19:00:06,563 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.88ms
2025-11-19 19:00:06,563 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.92ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 19:00:06,652 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 19:00:06,652 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 19:00:06,677 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=24.75ms
2025-11-19 19:00:06,677 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=25.80ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 19:00:15,655 - app_logger - INFO - REQUEST POST /connections/use/2 | Body={
  "password": "password"
}
2025-11-19 19:00:15,655 - app_logger - INFO - Incoming request: POST /connections/use/2
2025-11-19 19:00:16,063 - app_logger - INFO - Completed POST /connections/use/2 Status=200 Duration=408.11ms
2025-11-19 19:00:16,064 - app_logger - INFO - RESPONSE POST /connections/use/2 | Status=200 | Duration=409.06ms | Body={"message":"Connected successfully to 'ai_databasee'"}
2025-11-19 19:00:32,747 - app_logger - INFO - REQUEST POST /llmsql/generate_sql | Body={
  "user_input": "Hazme 10 recursos mockeados para la tabla customers"
}
2025-11-19 19:00:32,747 - app_logger - INFO - Incoming request: POST /llmsql/generate_sql
2025-11-19 19:00:32,748 - app_logger - INFO - Agent started for: Hazme 10 recursos mockeados para la tabla customers
2025-11-19 19:00:32,766 - app_logger - INFO - Running LLM with prompt (3350 chars)
2025-11-19 19:00:48,286 - app_logger - INFO - LLM execution time: 15519.15 ms
2025-11-19 19:00:48,286 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}


2025-11-19 19:00:48,286 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:00:48,287 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}
[2K
2025-11-19 19:00:48,293 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 19:00:48,293 - app_logger - INFO - Running LLM with prompt (3429 chars)
2025-11-19 19:00:53,164 - app_logger - INFO - LLM execution time: 4870.56 ms
2025-11-19 19:00:53,164 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 19:00:53,164 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:00:53,165 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 19:00:53,171 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 19:00:53,171 - app_logger - INFO - Running LLM with prompt (3596 chars)
2025-11-19 19:00:58,766 - app_logger - INFO - LLM execution time: 5595.01 ms
2025-11-19 19:00:58,767 - app_logger - DEBUG - ----- RAW STDOUT -----
```json
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
```


2025-11-19 19:00:58,767 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:00:58,767 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
```json
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
```
[2K
2025-11-19 19:00:58,767 - app_logger - INFO - describe_table requested for public.customers
2025-11-19 19:00:58,767 - app_logger - INFO - Cache miss for public.customers
2025-11-19 19:00:58,768 - app_logger - INFO - Fetching fresh metadata for public.customers
2025-11-19 19:00:58,770 - app_logger - DEBUG - load_sql result for table_columns.sql: SELECT 
    c.column_name,
    c.data_type,
    c.is_nullable,
    c.column_default,
    CASE WHEN pk.column_name IS NOT NULL THEN TRUE ELSE FALSE END AS is_primary_key,
    fk.foreign_table_name,
    fk.foreign_column_name
FROM information_schema.columns c
LEFT JOIN (
    SELECT 
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    WHERE tc.constraint_type = 'PRIMARY KEY'
) pk
    ON c.table_schema = pk.table_schema
    AND c.table_name = pk.table_name
    AND c.column_name = pk.column_name
LEFT JOIN (
    SELECT
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name,
        ccu.table_name AS foreign_table_name,
        ccu.column_name AS foreign_column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    JOIN information_schema.constraint_column_usage ccu
        ON ccu.constraint_name = tc.constraint_name
        AND ccu.table_schema = tc.table_schema
    WHERE tc.constraint_type = 'FOREIGN KEY'
) fk
    ON c.table_schema = fk.table_schema
    AND c.table_name = fk.table_name
    AND c.column_name = fk.column_name
WHERE c.table_schema = :schema_name
AND c.table_name = :table_name
ORDER BY c.ordinal_position;

2025-11-19 19:00:58,789 - app_logger - DEBUG - get_table_columns result for public.customers: [{'column_name': 'customer_id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': "nextval('customers_customer_id_seq'::regclass)", 'is_primary_key': True, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'first_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'last_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'email', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'created_at', 'data_type': 'timestamp without time zone', 'is_nullable': 'YES', 'column_default': 'CURRENT_TIMESTAMP', 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}]
2025-11-19 19:00:58,792 - app_logger - DEBUG - load_sql result for primary_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc
  ON tc.constraint_name = kc.constraint_name
WHERE tc.constraint_type = 'PRIMARY KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 19:00:58,795 - app_logger - DEBUG - fetch_primary_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'customers', 'column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_item_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'payment_id'}, {'table_schema': 'public', 'table_name': 'products', 'column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'id'}, {'table_schema': 'public', 'table_name': 'usuario', 'column_name': 'id'}]
2025-11-19 19:00:58,796 - app_logger - DEBUG - get_primary_keys result for public.customers: ['customer_id']
2025-11-19 19:00:58,798 - app_logger - DEBUG - load_sql result for foreign_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc 
  ON tc.constraint_name = kc.constraint_name
JOIN information_schema.constraint_column_usage ccu 
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 19:00:58,808 - app_logger - DEBUG - fetch_foreign_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'product_id', 'foreign_table_name': 'products', 'foreign_column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}]
2025-11-19 19:00:58,808 - app_logger - DEBUG - get_foreign_keys result for public.customers: []
2025-11-19 19:00:58,808 - app_logger - INFO - Stored metadata in cache for public.customers
2025-11-19 19:00:58,809 - app_logger - INFO - Stored fresh metadata for public.customers
2025-11-19 19:00:58,809 - app_logger - INFO - Running LLM with prompt (4787 chars)
2025-11-19 19:01:08,490 - app_logger - INFO - LLM execution time: 9681.30 ms
2025-11-19 19:01:08,491 - app_logger - DEBUG - ----- RAW STDOUT -----
FINAL_SQL
{
  "sql": "SELECT * FROM customers WHERE customer_id IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10);",
  "explanation": "Retrieve mock data for the first 10 customers."
}


2025-11-19 19:01:08,491 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:01:08,491 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
FINAL_SQL
{
  "sql": "SELECT * FROM customers WHERE customer_id IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10);",
  "explanation": "Retrieve mock data for the first 10 customers."
}
[2K
2025-11-19 19:01:08,503 - app_logger - INFO - Completed POST /llmsql/generate_sql Status=200 Duration=35756.36ms
2025-11-19 19:01:08,504 - app_logger - INFO - RESPONSE POST /llmsql/generate_sql | Status=200 | Duration=35757.26ms | Body={"generated_sql":"SELECT * FROM customers WHERE customer_id IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10);","explanation":"Retrieve mock data for the first 10 customers.","preview":"Review this SQL before execution."}
2025-11-19 19:01:22,956 - app_logger - INFO - REQUEST POST /llmsql/generate_sql | Body={
  "user_input": "Hazme un insert para 10 recursos mockeados para la tabla customers"
}
2025-11-19 19:01:22,957 - app_logger - INFO - Incoming request: POST /llmsql/generate_sql
2025-11-19 19:01:22,958 - app_logger - INFO - Agent started for: Hazme un insert para 10 recursos mockeados para la tabla customers
2025-11-19 19:01:22,969 - app_logger - INFO - Running LLM with prompt (3365 chars)
2025-11-19 19:01:26,912 - app_logger - INFO - LLM execution time: 3942.70 ms
2025-11-19 19:01:26,913 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}


2025-11-19 19:01:26,913 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:01:26,913 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}
[2K
2025-11-19 19:01:26,915 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 19:01:26,915 - app_logger - INFO - Running LLM with prompt (3444 chars)
2025-11-19 19:01:32,294 - app_logger - INFO - LLM execution time: 5378.44 ms
2025-11-19 19:01:32,294 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 19:01:32,294 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:01:32,294 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 19:01:32,296 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 19:01:32,297 - app_logger - INFO - Running LLM with prompt (3611 chars)
2025-11-19 19:01:37,581 - app_logger - INFO - LLM execution time: 5284.58 ms
2025-11-19 19:01:37,582 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}


2025-11-19 19:01:37,582 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:01:37,582 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "customers"
  }
}
[2K
2025-11-19 19:01:37,582 - app_logger - INFO - describe_table requested for public.customers
2025-11-19 19:01:37,583 - app_logger - INFO - Cache hit for public.customers
2025-11-19 19:01:37,583 - app_logger - INFO - Returning cached metadata for public.customers
2025-11-19 19:01:37,583 - app_logger - INFO - Running LLM with prompt (4802 chars)
2025-11-19 19:02:07,182 - app_logger - INFO - LLM execution time: 29598.90 ms
2025-11-19 19:02:07,182 - app_logger - DEBUG - ----- RAW STDOUT -----
FINAL_SQL
{
  "sql": "INSERT INTO public.customers (first_name, last_name, email) VALUES \
    ('John', 'Doe', 'john.doe@example.com'), \
    ('Jane', 'Smith', 'jane.smith@example.com'), \
    ('Alice', 'Johnson', 'alice.johnson@example.com'), \
    ('Bob', 'Brown', 'bob.brown@example.com'), \
    ('Charlie', 'Davis', 'charlie.davis@example.com'), \
    ('David', 'Evans', 'david.evans@example.com'), \
    ('Eve', 'Foster', 'eve.foster@example.com'), \
    ('Frank', 'Green', 'frank.green@example.com'), \
    ('Grace', 'Harris', 'grace.harris@example.com'), \
    ('Heidi', 'Jackson', 'heidi.jackson@example.com');",
  "explanation": "Inserting 10 mock customer records into the customers table."
}


2025-11-19 19:02:07,183 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:02:07,183 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
FINAL_SQL
{
  "sql": "INSERT INTO public.customers (first_name, last_name, email) VALUES \
    ('John', 'Doe', 'john.doe@example.com'), \
    ('Jane', 'Smith', 'jane.smith@example.com'), \
    ('Alice', 'Johnson', 'alice.johnson@example.com'), \
    ('Bob', 'Brown', 'bob.brown@example.com'), \
    ('Charlie', 'Davis', 'charlie.davis@example.com'), \
    ('David', 'Evans', 'david.evans@example.com'), \
    ('Eve', 'Foster', 'eve.foster@example.com'), \
    ('Frank', 'Green', 'frank.green@example.com'), \
    ('Grace', 'Harris', 'grace.harris@example.com'), \
    ('Heidi', 'Jackson', 'heidi.jackson@example.com');",
  "explanation": "Inserting 10 mock customer records into the customers table."
}
[2K
2025-11-19 19:02:07,193 - app_logger - INFO - Completed POST /llmsql/generate_sql Status=200 Duration=44236.17ms
2025-11-19 19:02:07,193 - app_logger - INFO - RESPONSE POST /llmsql/generate_sql | Status=200 | Duration=44237.14ms | Body={"generated_sql":"INSERT INTO public.customers (first_name, last_name, email) VALUES \\\n    ('John', 'Doe', 'john.doe@example.com'), \\\n    ('Jane', 'Smith', 'jane.smith@example.com'), \\\n    ('Alice', 'Johnson', 'alice.johnson@example.com'), \\\n    ('Bob', 'Brown', 'bob.brown@example.com'), \\\n    ('Charlie', 'Davis', 'charlie.davis@example.com'), \\\n    ('David', 'Evans', 'david.evans@example.com'), \\\n    ('Eve', 'Foster', 'eve.foster@example.com'), \\\n    ('Frank', 'Green', 'frank.green@example.com'), \\\n    ('Grace', 'Harris', 'grace.harris@example.com'), \\\n    ('Heidi', 'Jackson', 'heidi.jackson@example.com');","explanation":"Inserting 10 mock customer records into the customers table.","preview":"Review this SQL before execution."}
2025-11-19 19:03:01,232 - app_logger - INFO - REQUEST GET /db/columns | Body=
2025-11-19 19:03:01,233 - app_logger - INFO - Incoming request: GET /db/columns
2025-11-19 19:03:01,241 - app_logger - DEBUG - load_sql result for table_columns.sql: SELECT 
    c.column_name,
    c.data_type,
    c.is_nullable,
    c.column_default,
    CASE WHEN pk.column_name IS NOT NULL THEN TRUE ELSE FALSE END AS is_primary_key,
    fk.foreign_table_name,
    fk.foreign_column_name
FROM information_schema.columns c
LEFT JOIN (
    SELECT 
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    WHERE tc.constraint_type = 'PRIMARY KEY'
) pk
    ON c.table_schema = pk.table_schema
    AND c.table_name = pk.table_name
    AND c.column_name = pk.column_name
LEFT JOIN (
    SELECT
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name,
        ccu.table_name AS foreign_table_name,
        ccu.column_name AS foreign_column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    JOIN information_schema.constraint_column_usage ccu
        ON ccu.constraint_name = tc.constraint_name
        AND ccu.table_schema = tc.table_schema
    WHERE tc.constraint_type = 'FOREIGN KEY'
) fk
    ON c.table_schema = fk.table_schema
    AND c.table_name = fk.table_name
    AND c.column_name = fk.column_name
WHERE c.table_schema = :schema_name
AND c.table_name = :table_name
ORDER BY c.ordinal_position;

2025-11-19 19:03:01,251 - app_logger - DEBUG - get_table_columns result for public.customers: [{'column_name': 'customer_id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': "nextval('customers_customer_id_seq'::regclass)", 'is_primary_key': True, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'first_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'last_name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'email', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'created_at', 'data_type': 'timestamp without time zone', 'is_nullable': 'YES', 'column_default': 'CURRENT_TIMESTAMP', 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}]
2025-11-19 19:03:01,251 - app_logger - INFO - Completed GET /db/columns Status=200 Duration=18.49ms
2025-11-19 19:03:01,252 - app_logger - INFO - RESPONSE GET /db/columns | Status=200 | Duration=19.51ms | Body=[{"column_name":"customer_id","data_type":"integer","is_nullable":"NO","column_default":"nextval('customers_customer_id_seq'::regclass)","is_primary_key":true,"foreign_table_name":null,"foreign_column_name":null},{"column_name":"first_name","data_type":"character varying","is_nullable":"NO","column_default":null,"is_primary_key":false,"foreign_table_name":null,"foreign_column_name":null},{"column_name":"last_name","data_type":"character varying","is_nullable":"NO","column_default":null,"is_primary_key":false,"foreign_table_name":null,"foreign_column_name":null},{"column_name":"email","data_type":"character varying","is_nullable":"NO","column_default":null,"is_primary_key":false,"foreign_table_name":null,"foreign_column_name":null},{"column_name":"created_at","data_type":"timestamp without time zone","is_nullable":"YES","column_default":"CURRENT_TIMESTAMP","is_primary_key":false,"foreign_table_name":null,"foreign_column_name":null}]
2025-11-19 19:03:45,028 - app_logger - INFO - REQUEST GET /db/tables | Body=
2025-11-19 19:03:45,029 - app_logger - INFO - Incoming request: GET /db/tables
2025-11-19 19:03:45,047 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 19:03:45,048 - app_logger - INFO - Completed GET /db/tables Status=200 Duration=19.23ms
2025-11-19 19:03:45,049 - app_logger - INFO - RESPONSE GET /db/tables | Status=200 | Duration=20.13ms | Body=["customers","order_items","orders","payments","products","team","usuario"]
2025-11-19 19:03:50,301 - app_logger - INFO - REQUEST POST /llmsql/generate_sql | Body={
  "user_input": "Creame 10 recursos mockeados par la tabla team"
}
2025-11-19 19:03:50,301 - app_logger - INFO - Incoming request: POST /llmsql/generate_sql
2025-11-19 19:03:50,302 - app_logger - INFO - Agent started for: Creame 10 recursos mockeados par la tabla team
2025-11-19 19:03:50,314 - app_logger - INFO - Running LLM with prompt (3345 chars)
2025-11-19 19:03:54,117 - app_logger - INFO - LLM execution time: 3802.69 ms
2025-11-19 19:03:54,117 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}


2025-11-19 19:03:54,117 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:03:54,118 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}
[2K
2025-11-19 19:03:54,119 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 19:03:54,120 - app_logger - INFO - Running LLM with prompt (3424 chars)
2025-11-19 19:03:59,157 - app_logger - INFO - LLM execution time: 5036.65 ms
2025-11-19 19:03:59,157 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 19:03:59,157 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:03:59,157 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 19:03:59,159 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 19:03:59,160 - app_logger - INFO - Running LLM with prompt (3591 chars)
2025-11-19 19:04:04,368 - app_logger - INFO - LLM execution time: 5208.33 ms
2025-11-19 19:04:04,368 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "team"
  }
}


2025-11-19 19:04:04,368 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:04:04,369 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "describe_table",
  "arguments": {
    "schema": "public",
    "table": "team"
  }
}
[2K
2025-11-19 19:04:04,369 - app_logger - INFO - describe_table requested for public.team
2025-11-19 19:04:04,369 - app_logger - INFO - Cache miss for public.team
2025-11-19 19:04:04,369 - app_logger - INFO - Fetching fresh metadata for public.team
2025-11-19 19:04:04,372 - app_logger - DEBUG - load_sql result for table_columns.sql: SELECT 
    c.column_name,
    c.data_type,
    c.is_nullable,
    c.column_default,
    CASE WHEN pk.column_name IS NOT NULL THEN TRUE ELSE FALSE END AS is_primary_key,
    fk.foreign_table_name,
    fk.foreign_column_name
FROM information_schema.columns c
LEFT JOIN (
    SELECT 
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    WHERE tc.constraint_type = 'PRIMARY KEY'
) pk
    ON c.table_schema = pk.table_schema
    AND c.table_name = pk.table_name
    AND c.column_name = pk.column_name
LEFT JOIN (
    SELECT
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name,
        ccu.table_name AS foreign_table_name,
        ccu.column_name AS foreign_column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    JOIN information_schema.constraint_column_usage ccu
        ON ccu.constraint_name = tc.constraint_name
        AND ccu.table_schema = tc.table_schema
    WHERE tc.constraint_type = 'FOREIGN KEY'
) fk
    ON c.table_schema = fk.table_schema
    AND c.table_name = fk.table_name
    AND c.column_name = fk.column_name
WHERE c.table_schema = :schema_name
AND c.table_name = :table_name
ORDER BY c.ordinal_position;

2025-11-19 19:04:04,381 - app_logger - DEBUG - get_table_columns result for public.team: [{'column_name': 'id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': "nextval('team_id_seq'::regclass)", 'is_primary_key': True, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'customer_id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}]
2025-11-19 19:04:04,383 - app_logger - DEBUG - load_sql result for primary_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc
  ON tc.constraint_name = kc.constraint_name
WHERE tc.constraint_type = 'PRIMARY KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 19:04:04,387 - app_logger - DEBUG - fetch_primary_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'customers', 'column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_item_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'payment_id'}, {'table_schema': 'public', 'table_name': 'products', 'column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'id'}, {'table_schema': 'public', 'table_name': 'usuario', 'column_name': 'id'}]
2025-11-19 19:04:04,387 - app_logger - DEBUG - get_primary_keys result for public.team: ['id']
2025-11-19 19:04:04,389 - app_logger - DEBUG - load_sql result for foreign_keys.sql: SELECT 
    tc.table_schema, 
    tc.table_name, 
    kc.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints tc
JOIN information_schema.key_column_usage kc 
  ON tc.constraint_name = kc.constraint_name
JOIN information_schema.constraint_column_usage ccu 
  ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY'
  AND tc.table_schema NOT IN ('information_schema', 'pg_catalog', 'pg_toast')
  AND (:schema_name IS NULL OR tc.table_schema = :schema_name)
ORDER BY tc.table_schema, tc.table_name;

2025-11-19 19:04:04,398 - app_logger - DEBUG - fetch_foreign_keys result for schema=public: [{'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'order_items', 'column_name': 'product_id', 'foreign_table_name': 'products', 'foreign_column_name': 'product_id'}, {'table_schema': 'public', 'table_name': 'orders', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}, {'table_schema': 'public', 'table_name': 'payments', 'column_name': 'order_id', 'foreign_table_name': 'orders', 'foreign_column_name': 'order_id'}, {'table_schema': 'public', 'table_name': 'team', 'column_name': 'customer_id', 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}]
2025-11-19 19:04:04,398 - app_logger - DEBUG - get_foreign_keys result for public.team: [{'column': 'customer_id', 'ref_table': 'customers', 'ref_column': 'customer_id'}]
2025-11-19 19:04:04,399 - app_logger - INFO - Stored metadata in cache for public.team
2025-11-19 19:04:04,399 - app_logger - INFO - Stored fresh metadata for public.team
2025-11-19 19:04:04,399 - app_logger - INFO - Running LLM with prompt (4422 chars)
2025-11-19 19:04:10,452 - app_logger - INFO - LLM execution time: 6052.14 ms
2025-11-19 19:04:10,452 - app_logger - DEBUG - ----- RAW STDOUT -----
FINAL_SQL
{
  "sql": "SELECT * FROM team LIMIT 10;",
  "explanation": "Retrieve the first 10 records from the 'team' table."
}


2025-11-19 19:04:10,452 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:04:10,452 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
FINAL_SQL
{
  "sql": "SELECT * FROM team LIMIT 10;",
  "explanation": "Retrieve the first 10 records from the 'team' table."
}
[2K
2025-11-19 19:04:10,461 - app_logger - INFO - Completed POST /llmsql/generate_sql Status=200 Duration=20159.25ms
2025-11-19 19:04:10,461 - app_logger - INFO - RESPONSE POST /llmsql/generate_sql | Status=200 | Duration=20209.05ms | Body={"generated_sql":"SELECT * FROM team LIMIT 10;","explanation":"Retrieve the first 10 records from the 'team' table.","preview":"Review this SQL before execution."}
2025-11-19 19:04:31,880 - app_logger - INFO - REQUEST POST /llmsql/generate_sql | Body={
  "user_input": "Hazme un insert de 10 recursos mockeados para la tabla team"
}
2025-11-19 19:04:31,881 - app_logger - INFO - Incoming request: POST /llmsql/generate_sql
2025-11-19 19:04:31,882 - app_logger - INFO - Agent started for: Hazme un insert de 10 recursos mockeados para la tabla team
2025-11-19 19:04:31,893 - app_logger - INFO - Running LLM with prompt (3358 chars)
2025-11-19 19:04:35,627 - app_logger - INFO - LLM execution time: 3733.70 ms
2025-11-19 19:04:35,627 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}


2025-11-19 19:04:35,628 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:04:35,628 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}
[2K
2025-11-19 19:04:35,630 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 19:04:35,630 - app_logger - INFO - Running LLM with prompt (3437 chars)
2025-11-19 19:04:40,631 - app_logger - INFO - LLM execution time: 5000.73 ms
2025-11-19 19:04:40,632 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}


2025-11-19 19:04:40,632 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:04:40,632 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_tables",
  "arguments": {
    "schema": "public"
  }
}
[2K
2025-11-19 19:04:40,634 - app_logger - DEBUG - get_table_names result for schema=public: ['customers', 'order_items', 'orders', 'payments', 'products', 'team', 'usuario']
2025-11-19 19:04:40,634 - app_logger - INFO - Running LLM with prompt (3604 chars)
2025-11-19 19:04:46,666 - app_logger - INFO - LLM execution time: 6031.44 ms
2025-11-19 19:04:46,666 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL  
{  
  "name": "describe_table",  
  "arguments": {  
    "schema": "public",  
    "table": "team"  
  }  
}


2025-11-19 19:04:46,667 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:04:46,667 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL  
{  
  "name": "describe_table",  
  "arguments": {  
    "schema": "public",  
    "table": "team"  
  }  
}
[2K
2025-11-19 19:04:46,667 - app_logger - INFO - describe_table requested for public.team
2025-11-19 19:04:46,667 - app_logger - INFO - Cache hit for public.team
2025-11-19 19:04:46,668 - app_logger - INFO - Returning cached metadata for public.team
2025-11-19 19:04:46,668 - app_logger - INFO - Running LLM with prompt (4435 chars)
2025-11-19 19:04:53,005 - app_logger - INFO - LLM execution time: 6337.24 ms
2025-11-19 19:04:53,006 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "get_columns",
  "arguments": {
    "schema": "public",
    "table": "team"
  }
}


2025-11-19 19:04:53,006 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ã [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:04:53,006 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "get_columns",
  "arguments": {
    "schema": "public",
    "table": "team"
  }
}
[2K
2025-11-19 19:04:53,008 - app_logger - DEBUG - load_sql result for table_columns.sql: SELECT 
    c.column_name,
    c.data_type,
    c.is_nullable,
    c.column_default,
    CASE WHEN pk.column_name IS NOT NULL THEN TRUE ELSE FALSE END AS is_primary_key,
    fk.foreign_table_name,
    fk.foreign_column_name
FROM information_schema.columns c
LEFT JOIN (
    SELECT 
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    WHERE tc.constraint_type = 'PRIMARY KEY'
) pk
    ON c.table_schema = pk.table_schema
    AND c.table_name = pk.table_name
    AND c.column_name = pk.column_name
LEFT JOIN (
    SELECT
        kcu.table_schema,
        kcu.table_name,
        kcu.column_name,
        ccu.table_name AS foreign_table_name,
        ccu.column_name AS foreign_column_name
    FROM information_schema.table_constraints tc
    JOIN information_schema.key_column_usage kcu
        ON tc.constraint_name = kcu.constraint_name
        AND tc.table_schema = kcu.table_schema
    JOIN information_schema.constraint_column_usage ccu
        ON ccu.constraint_name = tc.constraint_name
        AND ccu.table_schema = tc.table_schema
    WHERE tc.constraint_type = 'FOREIGN KEY'
) fk
    ON c.table_schema = fk.table_schema
    AND c.table_name = fk.table_name
    AND c.column_name = fk.column_name
WHERE c.table_schema = :schema_name
AND c.table_name = :table_name
ORDER BY c.ordinal_position;

2025-11-19 19:04:53,016 - app_logger - DEBUG - get_table_columns result for public.team: [{'column_name': 'id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': "nextval('team_id_seq'::regclass)", 'is_primary_key': True, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'name', 'data_type': 'character varying', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': None, 'foreign_column_name': None}, {'column_name': 'customer_id', 'data_type': 'integer', 'is_nullable': 'NO', 'column_default': None, 'is_primary_key': False, 'foreign_table_name': 'customers', 'foreign_column_name': 'customer_id'}]
2025-11-19 19:04:53,017 - app_logger - INFO - Running LLM with prompt (5126 chars)
2025-11-19 19:04:56,572 - app_logger - INFO - LLM execution time: 3555.42 ms
2025-11-19 19:04:56,572 - app_logger - DEBUG - ----- RAW STDOUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}


2025-11-19 19:04:56,573 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¥ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†ß [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:04:56,573 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
TOOL_CALL
{
  "name": "list_schemas",
  "arguments": {}
}
[2K
2025-11-19 19:04:56,575 - app_logger - DEBUG - get_schemas result: ['public']
2025-11-19 19:04:56,575 - app_logger - INFO - Running LLM with prompt (5205 chars)
2025-11-19 19:05:14,290 - app_logger - INFO - LLM execution time: 17714.54 ms
2025-11-19 19:05:14,290 - app_logger - DEBUG - ----- RAW STDOUT -----
FINAL_SQL
{
  "sql": "INSERT INTO public.team (name, customer_id) VALUES ('Team A', 1), ('Team B', 2), ('Team C', 3), ('Team D', 4), ('Team E', 5), ('Team F', 6), ('Team G', 7), ('Team H', 8), ('Team I', 9), ('Team J', 10);",
  "explanation": "Inserting 10 mock records into the 'team' table with sample names and customer IDs."
}


2025-11-19 19:05:14,290 - app_logger - DEBUG - ----- RAW STDERR -----
[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?2026h[?25l[1G‚†∏ [K[?25h[?2026l[?2026h[?25l[1G‚†º [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†¶ [K[?25h[?2026l[?2026h[?25l[1G‚†á [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†è [K[?25h[?2026l[?2026h[?25l[1G‚†ô [K[?25h[?2026l[?2026h[?25l[1G‚†π [K[?25h[?2026l[?25l[?2026h[?25l[1G[K[?25h[?2026l[2K[1G[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h[?25l[?25h
2025-11-19 19:05:14,290 - app_logger - DEBUG - ----- CLEANED MODEL OUTPUT -----
FINAL_SQL
{
  "sql": "INSERT INTO public.team (name, customer_id) VALUES ('Team A', 1), ('Team B', 2), ('Team C', 3), ('Team D', 4), ('Team E', 5), ('Team F', 6), ('Team G', 7), ('Team H', 8), ('Team I', 9), ('Team J', 10);",
  "explanation": "Inserting 10 mock records into the 'team' table with sample names and customer IDs."
}
[2K
2025-11-19 19:05:14,299 - app_logger - INFO - Completed POST /llmsql/generate_sql Status=200 Duration=42418.80ms
2025-11-19 19:05:14,300 - app_logger - INFO - RESPONSE POST /llmsql/generate_sql | Status=200 | Duration=42419.73ms | Body={"generated_sql":"INSERT INTO public.team (name, customer_id) VALUES ('Team A', 1), ('Team B', 2), ('Team C', 3), ('Team D', 4), ('Team E', 5), ('Team F', 6), ('Team G', 7), ('Team H', 8), ('Team I', 9), ('Team J', 10);","explanation":"Inserting 10 mock records into the 'team' table with sample names and customer IDs.","preview":"Review this SQL before execution."}
2025-11-19 19:19:57,476 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 19:54:57,564 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 19:54:57,565 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 19:54:57,597 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=30.98ms
2025-11-19 19:54:57,597 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=34.30ms | Body={"total":4,"connections":[{"id":1,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:02.148481"},{"id":2,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:37.555428"},{"id":3,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:50.702764"},{"id":4,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:35:34.883914"}]}
2025-11-19 19:54:58,228 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 19:54:58,228 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 19:54:58,235 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=6.90ms
2025-11-19 19:54:58,235 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=7.75ms | Body={"total":4,"connections":[{"id":1,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:02.148481"},{"id":2,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:37.555428"},{"id":3,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:50.702764"},{"id":4,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:35:34.883914"}]}
2025-11-19 19:55:02,538 - app_logger - INFO - REQUEST GET /connections/list | Body=
2025-11-19 19:55:02,539 - app_logger - INFO - Incoming request: GET /connections/list
2025-11-19 19:55:02,542 - app_logger - INFO - Completed GET /connections/list Status=200 Duration=3.52ms
2025-11-19 19:55:02,543 - app_logger - INFO - RESPONSE GET /connections/list | Status=200 | Duration=5.04ms | Body={"total":4,"connections":[{"id":1,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:02.148481"},{"id":2,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:37.555428"},{"id":3,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:34:50.702764"},{"id":4,"name":"ai_databasee","host":"localhost","port":5432,"user":"user","database":"ai_database","created_at":"2025-11-19T18:35:34.883914"}]}
2025-11-19 19:55:03,239 - app_logger - INFO - REQUEST GET /cache/metadata/status | Body=
2025-11-19 19:55:03,239 - app_logger - INFO - Incoming request: GET /cache/metadata/status
2025-11-19 19:55:03,241 - app_logger - INFO - Completed GET /cache/metadata/status Status=200 Duration=1.27ms
2025-11-19 19:55:03,241 - app_logger - INFO - RESPONSE GET /cache/metadata/status | Status=200 | Duration=2.38ms | Body={"ttl_seconds":300,"schemas":{},"total_entries":0}
2025-11-19 19:55:08,035 - app_logger - INFO - REQUEST GET /cache/metadata/status | Body=
2025-11-19 19:55:08,035 - app_logger - INFO - Incoming request: GET /cache/metadata/status
2025-11-19 19:55:08,036 - app_logger - INFO - Completed GET /cache/metadata/status Status=200 Duration=0.88ms
2025-11-19 19:55:08,036 - app_logger - INFO - RESPONSE GET /cache/metadata/status | Status=200 | Duration=1.80ms | Body={"ttl_seconds":300,"schemas":{},"total_entries":0}
2025-11-19 20:51:14,801 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 20:52:47,950 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 20:53:18,123 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 20:53:46,593 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 20:57:00,159 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:15:11,030 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:15:40,227 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:20:44,241 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:21:15,833 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:21:48,559 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:22:47,416 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:24:42,755 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:25:13,956 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:25:43,217 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:33:46,861 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:56:29,765 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:57:13,999 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:57:24,794 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 23:57:24,795 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 23:57:24,796 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.82ms
2025-11-19 23:57:24,796 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.92ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 23:57:24,909 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 23:57:24,909 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 23:57:24,936 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=26.35ms
2025-11-19 23:57:24,936 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=27.40ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/model/":{"post":{"tags":["Model settings"],"summary":"Add Model","operationId":"add_model_model__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateModelRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"CreateModelRequest":{"properties":{"model_name":{"type":"string","title":"Model Name"},"system_prompt":{"type":"string","title":"System Prompt","default":""},"context":{"type":"string","title":"Context","default":""},"temperature":{"type":"number","title":"Temperature","default":0.2},"top_p":{"type":"number","title":"Top P","default":1.0},"seed":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Seed"}},"type":"object","required":["model_name"],"title":"CreateModelRequest"},"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 23:57:33,723 - app_logger - INFO - REQUEST POST /model/ | Body={
  "model_name": "string",
  "system_prompt": "",
  "context": "",
  "temperature": 0.2,
  "top_p": 1,
  "seed": 0
}
2025-11-19 23:57:33,724 - app_logger - INFO - Incoming request: POST /model/
2025-11-19 23:57:33,818 - app_logger - INFO - Completed POST /model/ Status=200 Duration=94.59ms
2025-11-19 23:57:33,819 - app_logger - INFO - RESPONSE POST /model/ | Status=200 | Duration=95.82ms | Body=null
2025-11-19 23:57:49,067 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:57:50,947 - app_logger - INFO - REQUEST POST /model/ | Body={
  "model_name": "stringa",
  "system_prompt": "",
  "context": "",
  "temperature": 0.2,
  "top_p": 1,
  "seed": 0
}
2025-11-19 23:57:50,947 - app_logger - INFO - Incoming request: POST /model/
2025-11-19 23:57:51,008 - app_logger - INFO - Completed POST /model/ Status=200 Duration=61.04ms
2025-11-19 23:57:51,009 - app_logger - INFO - RESPONSE POST /model/ | Status=200 | Duration=62.03ms | Body={"model_name":"stringa","context":"","top_p":1.0,"updated_at":"2025-11-19T23:57:50.951286","system_prompt":"","id":2,"temperature":0.2,"seed":0}
2025-11-19 23:58:25,374 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:59:01,257 - app_logger - INFO - SQLAssistantService initialized
2025-11-19 23:59:09,654 - app_logger - INFO - REQUEST GET /docs | Body=
2025-11-19 23:59:09,654 - app_logger - INFO - Incoming request: GET /docs
2025-11-19 23:59:09,655 - app_logger - INFO - Completed GET /docs Status=200 Duration=0.85ms
2025-11-19 23:59:09,656 - app_logger - INFO - RESPONSE GET /docs | Status=200 | Duration=1.86ms | Body=
    <!DOCTYPE html>
    <html>
    <head>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css">
    <link rel="shortcut icon" href="https://fastapi.tiangolo.com/img/favicon.png">
    <title>LLM-DB CONNECTOR API - Swagger UI</title>
    </head>
    <body>
    <div id="swagger-ui">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js"></script>
    <!-- `SwaggerUIBundle` is now available on the page -->
    <script>
    const ui = SwaggerUIBundle({
        url: '/openapi.json',
    "dom_id": "#swagger-ui",
"layout": "BaseLayout",
"deepLinking": true,
"showExtensions": true,
"showCommonExtensions": true,
oauth2RedirectUrl: window.location.origin + '/docs/oauth2-redirect',
    presets: [
        SwaggerUIBundle.presets.apis,
        SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
    })
    </script>
    </body>
    </html>
    
2025-11-19 23:59:09,736 - app_logger - INFO - REQUEST GET /openapi.json | Body=
2025-11-19 23:59:09,737 - app_logger - INFO - Incoming request: GET /openapi.json
2025-11-19 23:59:09,762 - app_logger - INFO - Completed GET /openapi.json Status=200 Duration=25.39ms
2025-11-19 23:59:09,763 - app_logger - INFO - RESPONSE GET /openapi.json | Status=200 | Duration=26.36ms | Body={"openapi":"3.1.0","info":{"title":"LLM-DB CONNECTOR API","version":"1.0.0"},"paths":{"/":{"get":{"summary":"List Routes","operationId":"list_routes__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/save":{"post":{"tags":["Database Connections"],"summary":"Save Connection","operationId":"save_connection_connections_save_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PGDBConnector"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/list":{"get":{"tags":["Database Connections"],"summary":"List Connections","operationId":"list_connections_connections_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/connections/{connection_id}":{"delete":{"tags":["Database Connections"],"summary":"Delete Connection","description":"Delete a connection by ID.","operationId":"delete_connection_connections__connection_id__delete","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/use/{connection_id}":{"post":{"tags":["Database Connections"],"summary":"Use Connection","description":"Activate and persist a connection by ID.","operationId":"use_connection_connections_use__connection_id__post","parameters":[{"name":"connection_id","in":"path","required":true,"schema":{"type":"integer","title":"Connection Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordBody"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/connections/disconnect":{"post":{"tags":["Database Connections"],"summary":"Disconnect","description":"Close current connection.","operationId":"disconnect_connections_disconnect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/llmsql/generate_sql":{"post":{"tags":["SQL Assistant"],"summary":"Generate Sql","description":"Generates SQL using the intelligent multi-step agent.\nIt will automatically inspect the DB using tools if needed.","operationId":"generate_sql_llmsql_generate_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/execute_sql":{"post":{"tags":["SQL Assistant"],"summary":"Execute Sql","description":"Executes the SQL safely through the internal database service.","operationId":"execute_sql_llmsql_execute_sql_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ExecuteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/llmsql/history":{"get":{"tags":["SQL Assistant"],"summary":"Get Sql History","operationId":"get_sql_history_llmsql_history_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}},"/db/schema":{"get":{"tags":["Database Schema"],"summary":"Get Schema Grouped","description":"Returns the database schema grouped by table,\noptionally filtered by schema name (e.g. ?schema=public).","operationId":"get_schema_grouped_db_schema_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Schema name to filter (e.g. 'public')","title":"Schema"},"description":"Schema name to filter (e.g. 'public')"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/schemas":{"get":{"tags":["Database Schema"],"summary":"List Schemas","description":"Return all schema names in the database.","operationId":"list_schemas_db_schemas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/db/tables":{"get":{"tags":["Database Schema"],"summary":"List Tables","description":"Return all table names from the given schema.","operationId":"list_tables_db_tables_get","parameters":[{"name":"schema","in":"query","required":false,"schema":{"type":"string","default":"public","title":"Schema"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/db/columns":{"get":{"tags":["Database Schema"],"summary":"Get Table Columns","description":"Return all columns for a specific table, including data type,\nnullability, default value, and key relationships.","operationId":"get_table_columns_db_columns_get","parameters":[{"name":"table","in":"query","required":true,"schema":{"type":"string","description":"Table name to extract columns from","title":"Table"},"description":"Table name to extract columns from"},{"name":"schema","in":"query","required":false,"schema":{"type":"string","description":"Schema name (default: public)","default":"public","title":"Schema"},"description":"Schema name (default: public)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/invalidate":{"post":{"tags":["cache"],"summary":"Invalidate Metadata Cache","operationId":"invalidate_metadata_cache_cache_metadata_invalidate_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetadataCacheInvalidateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/cache/metadata/status":{"get":{"tags":["cache"],"summary":"Get Metadata Cache Status","operationId":"get_metadata_cache_status_cache_metadata_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/model/":{"post":{"tags":["Model settings"],"summary":"Add Model","operationId":"add_model_model__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateModelRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/model/list":{"get":{"tags":["Model settings"],"summary":"List Models","operationId":"list_models_model_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}}}}},"components":{"schemas":{"CreateModelRequest":{"properties":{"model_name":{"type":"string","title":"Model Name"},"system_prompt":{"type":"string","title":"System Prompt","default":""},"context":{"type":"string","title":"Context","default":""},"temperature":{"type":"number","title":"Temperature","default":0.2},"top_p":{"type":"number","title":"Top P","default":1.0},"seed":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Seed"}},"type":"object","required":["model_name"],"title":"CreateModelRequest"},"ExecuteRequest":{"properties":{"sql":{"type":"string","title":"Sql"}},"type":"object","required":["sql"],"title":"ExecuteRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MetadataCacheInvalidateRequest":{"properties":{"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Schema"},"table":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Table"}},"type":"object","title":"MetadataCacheInvalidateRequest"},"PGDBConnector":{"properties":{"host":{"type":"string","title":"Host"},"port":{"type":"integer","title":"Port"},"user":{"type":"string","title":"User"},"password":{"type":"string","title":"Password"},"database":{"type":"string","title":"Database"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["host","port","user","password","database"],"title":"PGDBConnector"},"PasswordBody":{"properties":{"password":{"type":"string","title":"Password"}},"type":"object","required":["password"],"title":"PasswordBody"},"QueryRequest":{"properties":{"user_input":{"type":"string","title":"User Input"}},"type":"object","required":["user_input"],"title":"QueryRequest"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}
2025-11-19 23:59:13,524 - app_logger - INFO - REQUEST GET /model/list | Body=
2025-11-19 23:59:13,525 - app_logger - INFO - Incoming request: GET /model/list
2025-11-19 23:59:13,535 - app_logger - INFO - Completed GET /model/list Status=200 Duration=9.64ms
2025-11-19 23:59:13,535 - app_logger - INFO - RESPONSE GET /model/list | Status=200 | Duration=10.69ms | Body=[{"model_name":"string","id":1,"system_prompt":"","temperature":0.2,"seed":0,"context":"","top_p":1.0,"updated_at":"2025-11-19T23:57:33.731346"},{"model_name":"stringa","id":2,"system_prompt":"","temperature":0.2,"seed":0,"context":"","top_p":1.0,"updated_at":"2025-11-19T23:57:50.951286"}]
2025-11-19 23:59:35,358 - app_logger - INFO - SQLAssistantService initialized
